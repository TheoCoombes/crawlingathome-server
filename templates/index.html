<!DOCTYPE HTML>

<html>
	<head>
	    <title>Captions@Home</title>
        <link href="https://cdn.jsdelivr.net/gh/TheoCoombes/crawlingathome-server@main/cdn/bootstrap.min.css" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<meta http-equiv="refresh" content="30">
	</head>
	<body style='margin-left: 25px; margin-right: 25px; margin-top: 25px;'>
        {% if banner %}
            <div class="alert alert-primary" role="alert">{{ banner.decode() | safe }}</div>
            <br>
        {% endif %}
        <h1>Captions@Home Dashboard</h1>
        <br><br>
        <h2>Stats</h2>
        <br>
        <strong>Completion: {{ "{0:.2f}".format(completion_float) }}%</strong> ({{ completion_str }} jobs completed)
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: {{ completion_float }}%;" aria-valuenow='{{ completion_float }}' aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <br><br>
        <strong>Estimated Time Until Completion:</strong> {{ eta }}
        <br><br><br>
        <h2>Connected Workers - {{ "{:,}".format(len_clients) }}</h2>
        <br>
        {% if len_clients != 0 %}
            <table class="table">
                <thead>
                    <tr>
                    <th scope="col">Name</th>
                    <th scope="col">Job UUID</th>
                    <th scope="col">Job Progress</th>
                    <th scope="col">Jobs Completed</th>
                    <th scope="col">Device ID</th>
                    <th scope="col">Last Seen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for worker in clients %}
                        <tr>
                            <th scope="row"><a href="/worker/{{ worker.display_name }}">{{ worker.display_name }}</a></th>
                            {% if not worker.job %}
                                <td><i>Waiting</i></td>
                            {% else %}
                                <td>{{ worker.job.number }}</td>
                            {% endif %}
                            <td>{{ worker.progress }}</td>
                            <td>{{ "{:,}".format(worker.jobs_completed) }}</td>
                            <td>{{ worker.user_nickname }}</td>
                            <td class="timestamp">{{ worker.last_seen }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <br>
            {% if len_clients > 50 and not all %}
                <i>Limited view to 50 workers. <a href="/?all=true">View All</a></i><br>
            {% endif %}
        {% elif completion_float == 100.0 %}
            <p>All jobs have been completed!</p>
        {% else %}
            <p>There are no workers currently connected to the server.</p>
        {% endif %}
	

        <br><br>

        Server Version: v3.3.0 <br>
        Latest Client Version: v1.5.0 <br>
	<br><br>
	
	<i>Disclaimer: The Captions@Home project is not affiliated with io.community.</i>
	<br><br>

        <script src="https://cdn.jsdelivr.net/gh/TheoCoombes/crawlingathome-server@main/cdn/main.js"></script>
	</body>
</html>
